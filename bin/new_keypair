#!/usr/bin/env node

'use strict'

var key_name = process.argv[2]
var output_path = process.argv[3]

if (!(key_name && output_path)) {
  console.log('please provide a key name and output path as arguments to generate a key-pair')
  console.log('exiting...')
  process.exit(1)
}

var fs = require('fs')

var key_path = output_path + '/' + key_name + '.private'
var key_exists = fs.existsSync(key_path)

if (key_exists) {
  console.log('the given key name and output path already exists, please choose a new key name')
  console.log('exiting...')
  process.exit(1)
}

var ursa = require('ursa')

var private_key = ursa.generatePrivateKey(4096)
var private_pem = private_key.toPrivatePem('utf8')

try {
  fs.writeFileSync(key_path, private_pem, {
    encoding: 'utf8',
    mode: 0o600
  })
} catch (e) {
  console.log('error occurred while writing key data to disk', e)
  console.log('exiting...')
  process.exit(1)
}

console.log('wrote new key pair to disk at', key_path)
process.exit(0)